
# 114 學年度工業類科學生技藝競賽 — 電腦修護
## 第二站：USB 介面卡製作與控制 — 題目功能與規格詳細分析

> 本文件整理自「114電腦修護-第二站(中區模擬賽).pdf」，將評分表與題目說明重新結構化，轉為實作導向的技術規格與注意事項，方便練習與教學使用。

---

## 一、整體任務總覽

本站以 **「USB 介面卡 + 電腦應用程式」整合控制** 為主題，要求選手：

1. **焊接與組裝 USB 介面卡**（題目已先完成或於別站完成，此處重點在軟體）  
2. **撰寫微控制器程式（AVR / ATmega328P 類）**  
   - 控制 TFT 顯示（時間 / 狀態 / 模式）  
   - 控制 WS2812 RGB LED（隨機顏色與腳位對應）  
   - 讀寫 EEPROM（模式與 LED 腳位資訊）  
   - 按鍵偵測（單鍵、雙鍵功能）  
   - 與 PC 維持序列通訊（時間同步、狀態回報）  
3. **撰寫電腦端程式（建議 VB.NET 或 C# WinForm）**
   - 自動偵測 / 選擇 COM Port  
   - 顯示系統時間、CPU 使用率、RAM 使用量、裝置狀態  
   - 控制與顯示 TFT 模式切換  
   - 對介面卡讀寫 EEPROM（LED 控制腳位）  
   - 維持連線狀態、處理 Open / Close 流程  

**比賽本質**：  
- 這一站是「**PC 應用程式 + USB 裝置通訊 + 內嵌系統控制 + EEPROM 狀態保持**」的整合題。  
- 失分常見點：**時間同步不準、EEPROM 沒存正確、LED 腳位解碼錯誤、Open/Close 流程不完整、斷電後狀態無法還原**。

---

## 二、硬體與模組功能整理

### 2.1 硬體主要元件

- MCU：ATmega328P / Arduino 類板（題目未明寫，但以往均採此）  
- 顯示：TFT LCD（SPI，文字顯示 + 簡單圖示）  
- LED：WS2812 / WS2812B（8 顆 RGB LED 串接）  
- 按鍵：S1、S2、S3、S4 四顆（實際多用到 S1、S2，S3、S4 供模式選擇）  
- 通訊介面：USB → Serial（CH340 / FT232 / CP2102）  
- 藍牙模組：支援 AT Command（通常為 HC-05 / HC-06 / JDY 類）  
- EEPROM：MCU 內部 EEPROM（用來存模式、LED 腳位數值）  

### 2.2 硬體端主要行為

1. **按鍵輸入**：  
   - 單鍵：S1 ~ S4 → 顯示 `btn-x`  
   - 雙鍵：S1 + S2 → 啟動 RGB 隨機顯示 + LED 顏色改變  

2. **TFT 顯示內容**  
   - 左上角：時間（格式依模式而定）  
   - 中央：崗位號碼 / 按鍵文字 / EEPROM 值等  
   - 右上角：
     - 連線符號（是否與 PC 程式連線）  
     - 模式代號（C1、C3、5 … 等）  

3. **WS2812 LED 控制**  
   - 初始：全滅  
   - 雙鍵模式（未寫入 EEPROM 前）：全部 LED 同色隨機變化  
   - 雙鍵模式（EEPROM 已寫入腳位值後）：依二進位腳位決定哪些 LED 點亮  

4. **EEPROM 使用**  
   - 儲存顯示模式（完整時間 / 只顯示 HH:mm:ss）  
   - 儲存 LED 腳位數值（1 ~ 254，255 為預設）  
   - 斷電重新上電後必須能：  
     - 還原時間顯示模式  
     - 還原 LED 腳位控制行為  

---

## 三、電腦程式功能整理

### 3.1 視窗標題與基本 UI

- 標題列必須為：  
  > 「114學年度工業類科學生技藝競賽電腦修護職種第二站 崗位號碼：XX」  
- 介面至少包含：  
  1. **Current Time**：yyyy/MM/dd HH:mm:ss（電腦系統時間）  
  2. **COM Port 下拉選單**（且會自動更新）  
  3. **Device Status**：顯示 On/Offline  
  4. **Open / Close 按鈕**  
  5. **Time Sync 模式選擇**（顯示設置 / 電腦資訊等）  
  6. **CPU 使用率、RAM 使用量** 文字或進度條  
  7. **LED 腳位讀寫區**：數字輸入框 + Read / Write 按鈕  

### 3.2 Open / Close 流程控制

- **按 Open：**
  - 開啟 Serial Port（配合 ComboBox 選定的 COM）  
  - 傳送初始化命令 → MCU  
  - MCU 回傳訊息 → PC 更新 Device Status「Device Online」  
  - TFT 右上角連線符號從未連線狀態變為已連線狀態  
  - 開始：
    - 定時送出時間同步封包  
    - 定時請求 MCU 上報狀態（模式、LED 值等）  

- **按 Close：**
  - 關閉 Serial Port  
  - 視窗上所有功能按鈕與欄位須置為灰階不可操作  
  - 再按 Open：  
    - 不需再點其他東西，程式需自動完成重新連線並恢復所有功能  
  - TFT 連線符號須隨狀態變化（已連線 / 未連線）  

### 3.3 COM Port 自動更新

- 執行期間：COM Port 列表要自動更新  
  - 常見作法：每隔 1~2 秒重新掃描 `SerialPort.GetPortNames()`  
  - 與前一次結果相比較，有變化才更新 UI（避免一直閃爍）  

### 3.4 CPU / RAM 使用率

- 題目要求：在「電腦資訊」模式下：  
  - PC 程式顯示 CPU Usage %  
  - 顯示 RAM 使用量：已用 / 總量（GB）  
  - MCU TFT 右上角模式值改變（如 C3），同時以進度條顯示 CPU / RAM 已用比例  

- 典型用法（.NET）：  
  - CPU：`PerformanceCounter("Processor", "% Processor Time", "_Total")` 或 WMI  
  - RAM：使用 `GC.GetTotalMemory` + 系統總記憶體 或 WMI `Win32_OperatingSystem`  

### 3.5 EEPROM 腳位讀寫機制

- **Read 行為：**
  - 刚啟動程式時，LED 腳位欄位預設為空字串  
  - 按下 Read → 若 EEPROM 尚未寫入 → 讀出 **255**  
  - 當 EEPROM 已寫入其他數字，再按 Read → 必須讀出 EEPROM 內的實際數值（例如 230）  

- **Write 行為：**
  - 使用者輸入 1 ~ 254 間之數值  
  - 按 Write → 傳給 MCU（指令 + 數據）  
  - MCU 驗證數值合法 → 寫入 EEPROM  
  - 寫入成功後：  
    - MCU TFT 右上角模式顯示 `5`  
    - 並且每秒閃爍文字 `Locked`  

---

## 四、評分項目逐條解析與實作重點

> 以下將比賽評分表中的每一項，轉換成「要做到什麼」、「會怎麼測」、「常見錯誤」三個角度。

### 4.1 項目 1：單鍵按鈕顯示與自動還原

**需求摘要：**  
- 開機後：TFT 顯示時間、崗位號碼「XX」、LED 全滅。  
- 按 S1 ~ S4 任一按鍵：  
  - 中央顯示 `btn-1` / `btn-2` … 等  
  - 約 0.5 秒後自動回到原本顯示「XX」的畫面  

**實作重點：**  
- 需有 **去彈跳** 機制（避免多次觸發）  
- `btn-x` 顯示時間要用定時器判斷，而非 delay（避免卡死主迴圈）  
- 優先順序：若有兩顆按鍵近乎同時按下，需符合題目需求（雙鍵項目時，偵測 S1+S2 專用邏輯）  

**常見失分：**  
- 顯示字串錯誤（多空格、大小寫錯誤）  
- 0.5 秒未準確，或 delay 造成整個系統暫停  
- 放開按鍵後沒有回到初始畫面  

---

### 4.2 項目 2：雙鍵隨機 RGB 顯示 + LED 同步變色

**需求摘要：**  
- 同時按著 S1 + S2 持續 0.5 秒以上：  
  - TFT 顯示 R/G/B 三個隨機數值（0~255）  
  - 每秒重新產生新的隨機 R/G/B 並更新顯示  
  - 所有 WS2812 LED 用同一個 RGB 亮起  
- 放開按鍵 → TFT 與 LED 皆恢復到原狀態（顯示崗位號碼、LED 關閉）  

**實作重點：**  
- 使用 **狀態機**：  
  - NORMAL 狀態  
  - BTN_COMBO 狀態（S1+S2）  
- 隨機數：可使用 `rand()` 或 MCU 提供的亂數函式  
- WS2812 更新頻率需控制（1 秒一次即可）  
- 需避免與「EEPROM 已寫入後的雙鍵功能」搞混（後者依腳位數值控制哪些 LED 亮起）  

**常見失分：**  
- 沒有做 0.5 秒判斷，按一下就進入隨機模式  
- LED 沒有跟 RGB 值一致（顯示值與實際顏色不相符）  
- 放開按鍵後未回復 LED 全滅  

---

### 4.3 項目 3：藍牙名稱設定

**需求摘要：**  
- 藍牙模組名稱需改為：`BT-XX`（XX 為崗位號碼）  
- 密碼可自行設定（但通常會要求 4 位數，例如 1234 或 0000）  

**實作重點：**  
- 使用 AT 指令設定：  
  - `AT+NAME=BT-XX`  
  - 若是 HC-05/06，需進「AT 模式」設定一次，之後即可永久保存  
- 比賽中：通常 **考前就會設定好**，這一項多半是前置作業或第一站任務。  

**常見失分：**  
- 名稱大小寫不符  
- 多打空格或前後有空白  

---

### 4.4 項目 4~6：PC 程式 UI + 連線 + 時間同步

**需求摘要：**  
- 標題列、時間顯示、裝置狀態、Open / Close 等全部依照題意呈現。  
- 按 Open → 連線成功 →  
  - TFT 時間自電腦同步（格式 yyyy/MM/dd HH:mm:ss 或 HH:mm:ss）  
  - TFT 右上角連線圖示變化  
- 按 Close：  
  - 所有控制項變灰不可操作  
  - 再按 Open：須自動重新連線並恢復全部功能（無須使用者再調整任何其他輸入）  

**實作重點：**  
- 使用 Timer 更新畫面與時間  
- SerialPort DataReceived 事件處理 MCU 回傳的狀態  
- Open / Close 要妥善 try/catch，避免拋例外程式當掉  
- Time Sync 封包格式要明確定義，例如：  
  - `T2024/10/23 13:20:32\n`  
  - MCU 解析後更新 RTC 或內部時間變數  

**常見失分：**  
- Close 後忘記將按鈕 Disable  
- 重按 Open 時沒有重新同步狀態  
- COM Port 被佔用導致程式掛掉未處理  

---

### 4.5 項目 5：電腦資訊模式 — CPU / RAM 使用率

**需求摘要：**  
- 切換 TFT 模式到「電腦資訊」：  
  - TFT 右上角模式號碼更動  
  - PC 程式顯示 CPU 使用率、RAM（GB 已用 / 總量）  
  - MCU TFT 用數值或進度條呈現 CPU / RAM 資訊  

**實作重點：**  
- `PC → MCU`：定時送出 CPU / RAM 資料，例如：  
  - `Scpu=58;ram=8.3/15.9\n`  
- `MCU` 解析後更新 TFT 顯示與進度條。  
- 需考慮封包解析穩定性（避免字串解析錯誤時整個畫面亂掉）。  

**常見失分：**  
- 僅在 PC 顯示，TFT 未同步  
- 進度條比例計算錯誤  

---

### 4.6 項目 6：顯示模式設定與 EEPROM 保存

**需求摘要：**  
- 在「顯示設置」模式中，可切換時間格式：  
  - `yyyy/MM/dd HH:mm:ss`  
  - `HH:mm:ss`  
- 斷電再開機後，必須保持最後設定的模式。  

**實作重點：**  
- 顯示模式需儲存在 EEPROM 某一位，例如：  
  - 0 → 完整日期時間  
  - 1 → 只顯示時間  
- 每次開機時：  
  - 讀取 EEPROM → 設定初始顯示模式  
- 切換時：  
  - 更新顯示 + 立即寫入 EEPROM  

**常見失分：**  
- EEPROM 地址與 LED 腳位共用或覆蓋  
- 開機未讀取 EEPROM，導致模式不保持  

---

### 4.7 項目 7：LED 腳位讀寫與資料驗證

**需求摘要：**  
- LED 腳位輸入框預設為空  
- 按 Read → 讀出「預設值 255」（表示尚未設定）  
- 使用者輸入 1~254 → 按 Write：  
  - 程式先檢查數字範圍（輸入驗證）  
  - 傳給 MCU，MCU 再檢查一次  
  - 寫入 EEPROM 成功後 → TFT 右上角模式顯示「5」並閃爍 `Locked`  

**實作重點：**  
- 兩邊都要做檢查：  
  - PC 端：避免輸入非數字或超出範圍（0、255、負數…）  
  - MCU 端：收到資料仍需檢查範圍才寫入 EEPROM  
- 傳輸協定設計：  
  - 例如 `L230\n` 表示寫入 230，`R\n` 表示要求讀取。  

**常見失分：**  
- 只在 PC 檢查，MCU 端完全未檢查  
- 寫入後 TFT 未顯示 Locked 或模式代碼錯誤  

---

### 4.8 項目 8：斷電後狀態維持 + 雙鍵 LED 腳位點亮

**需求摘要：**  
- 斷電 5 秒後再上電：  
  - MCU TFT 時間不得與電腦時間差超過 20 秒（配合重新 Time Sync）  
  - 顯示模式、連線狀態、腳位數值需與斷電前一致（狀態應從 EEPROM 還原）  
- 再按 S1 + S2（0.5 秒）：  
  - 仍可啟動隨機 RGB 模式  
  - 但不再是「全部 LED 同色全亮」，而是依 EEPROM 腳位數值（二進位）控制哪些 LED 點亮。  

**實作重點：**  
- LED 腳位值解析：  
  - 例如 EEPROM = 230：  
    - 230 = 1110 0110 (二進位)  
    - 可對應到 8 顆 LED 由左到右的亮滅狀態  
- 開機流程：  
  - 從 EEPROM 讀模式值、LED 腳位值 → 設好內部變數  
  - 等 PC Open 後，再同步時間  
- 雙鍵模式程式邏輯需分成兩階段：  
  1. EEPROM 未設定（255）：全部 LED 同色全亮  
  2. EEPROM 已設定（1~254）：依 bit 決定哪些 LED 亮，但顏色仍為隨機 RGB  

**常見失分：**  
- 忘記判斷 255 與其他值的差異  
- 二進位 bit 解析方向顛倒（LED 順序左右反）  

---

### 4.9 項目 9：PC 再次 Read EEPROM

**需求摘要：**  
- 重開程式、重新連線後：  
  - 按 Read → 必須從 EEPROM 讀出目前 LED 腳位值  
  - 不可以再回到預設值 255。  

**實作重點：**  
- 程式啟動後第一次按 Read：  
  - 直接發送「讀取 EEPROM」指令給 MCU  
  - 不使用內部暫存舊值  
- 必須確保：  
  - MCU 始終以 EEPROM 實際內容回傳，而不是程式內預設常數  

**常見失分：**  
- 在 PC 端用變數暫存 LED 值，只在第一次 Write 改變，結果重開程式就讀不到實際 EEPROM 值。  

---

### 4.10 項目 10：時間分數

- 所有功能都 **完全正確且穩定** 的前提下才會給時間分。  
- 第一名：10 分  
- 第二名：9 分 …  
- 第十名之後：0 分。  

**策略建議：**  
1. 先確保核心分數（功能分）全拿到，再追求時間。  
2. 練習時依照實際比賽流程模擬一次完整插卡、開機、執行程式、測試全部項目的順序。  

---

## 五、整體實作策略建議

1. **先做 MCU，後做 PC 程式**  
   - 先讓 TFT 能顯示時間（內部 fake 時鐘）、按鍵、LED 顯示正常，再加入 Serial 通訊與 EEPROM。  

2. **通訊協定先定好**  
   - 建議用簡單文字封包：  
     - `T2024/10/23 13:20:32` → 時間同步  
     - `Scpu=58;ram=8.3/15.9` → 系統資訊  
     - `L230` → 設定 LED 腳位值  
     - `R` → 要求回傳 LED 腳位值  

3. **EEPROM 地址規劃**  
   - addr 0：顯示模式  
   - addr 1：LED 腳位值  
   - 其他地址保留以後擴充  

4. **測試腳本**  
   - 建議自己列一份「評分表檢查清單」，從開機 → 單鍵 → 雙鍵 → Open → Close → 模式切換 → LED 寫入 → 斷電重上電 → 雙鍵 → Read，照順序做一遍。  

---

## 六、延伸：可將本說明轉為教學講義

- 可加入：  
  - MCU 偽碼 / 程式骨架  
  - PC 端 VB / C# 範例專案架構  
  - EEPROM 測試小工具（單獨驗證讀寫）  
- 亦可在班上模擬實作考，直接以本文件為說明用講義。

---

（完）
